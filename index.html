<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NekoCore v35</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;800&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div id="toast-container"></div>
    <div id="bg-canvas"></div> 

    <div id="loader">
        <i class="fas fa-atom fa-3x fa-spin" style="color:#d600ff; margin-bottom:20px;"></i>
        <div style="font-family:'Exo 2'; font-weight:800; color:#fff;">NEKO CORE</div>
    </div>

    <div id="app-root">
        <div id="view-auth" class="modal-box hidden">
            <h1 style="font-family:'Exo 2'; color:#d600ff;">NEKO ID</h1>
            <input type="email" id="auth-email" placeholder="E-mail">
            <input type="password" id="auth-pass" placeholder="Password">
            <input type="text" id="auth-nick" placeholder="Codename" style="display:none;">
            <button class="btn-solid" onclick="Auth.submit()" style="margin-top:15px;">LOGIN</button>
            <div style="margin-top:15px; display:flex; justify-content:space-between; font-size:0.8rem; color:#666;">
                <span onclick="Auth.toggle()" style="cursor:pointer;">Register</span>
                <span onclick="Auth.reset()" style="cursor:pointer;">Reset</span>
            </div>
        </div>

        <div id="view-main" class="hidden">
            <div id="sidebar" class="sidebar">
                <div class="sidebar-header"><span style="color:#d600ff;">NEKO</span>CORE</div>
                <div class="nav-group">
                    <div class="nav-item active" onclick="Route('news')"><i class="fas fa-rss"></i> NEWS</div>
                    <div class="nav-item" onclick="Route('channels')"><i class="fas fa-hashtag"></i> CHANNELS</div>
                    <div class="nav-item" onclick="Route('dms')"><i class="fas fa-comments"></i> MESSAGES</div>
                    <div class="nav-item" onclick="Route('search')"><i class="fas fa-search"></i> SEARCH</div>
                </div>
                <div class="nav-group bottom">
                    <div id="nav-admin" class="nav-item hidden" onclick="Route('admin')"><i class="fas fa-shield-alt" style="color:#ff0055"></i> ADMIN</div>
                    <div class="nav-item" onclick="Route('profile')"><i class="fas fa-user-circle"></i> PROFILE</div>
                    <div class="nav-item" onclick="Auth.logout()"><i class="fas fa-power-off"></i> EXIT</div>
                </div>
            </div>

            <div class="content-wrapper">
                <div id="tab-news" class="tab-pane active">
                    <div class="top-bar"><div class="top-title">NEWS</div></div>
                    <div id="news-feed" class="messages-container"></div>
                    <div id="news-input" class="chat-input-area hidden">
                        <input type="text" id="news-msg-in" placeholder="Broadcast...">
                        <button class="btn-solid" style="width:50px;" onclick="Chat.send('news')"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
                <div id="tab-channels" class="tab-pane">
                    <div class="top-bar"><div class="top-title">CHANNELS</div><i class="fas fa-plus" style="cursor:pointer; color:#d600ff; font-size:1.2rem;" onclick="document.getElementById('modal-create').classList.add('open')"></i></div>
                    <div id="channel-list" class="list-container"></div>
                </div>
                <div id="tab-chat" class="tab-pane">
                    <div class="top-bar"><i class="fas fa-arrow-left" style="cursor:pointer;" onclick="Route('channels')"></i><div class="top-title" id="chat-title">CHAT</div></div>
                    <div id="chat-feed" class="messages-container"></div>
                    <div class="chat-input-area">
                        <label for="file-in" style="cursor:pointer; color:#888;"><i class="fas fa-paperclip"></i></label>
                        <input type="file" id="file-in" hidden multiple accept="image/*">
                        <input type="text" id="msg-in" placeholder="Message...">
                        <button class="btn-solid" style="width:50px;" onclick="Chat.send()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
                <div id="tab-dms" class="tab-pane"><div class="top-bar"><div class="top-title">MESSAGES</div></div><div id="dm-list" class="list-container"></div></div>
                <div id="tab-search" class="tab-pane"><div class="top-bar"><div class="top-title">SEARCH</div></div><div style="padding:20px;"><input type="text" id="search-in" placeholder="Search..." oninput="Search.run()"></div><div id="search-results" class="list-container"></div></div>
                
                <div id="tab-profile" class="tab-pane">
                    <div class="top-bar"><div class="top-title">EDITOR</div></div>
                    <div class="admin-scroll-area"> <div class="p-20 flex-col" style="gap:15px;">
                            <div style="background:#0e0e12; border:1px solid #333; border-radius:16px; overflow:hidden;">
                                <div id="my-banner-prev" style="height:120px; background:#222; background-size:cover; background-position:center;"></div>
                                <div style="padding:0 20px 20px 20px; text-align:center; margin-top:-40px;">
                                    <img id="my-avi" style="width:80px; height:80px; border-radius:50%; border:4px solid #0e0e12; object-fit:cover; background:#000;">
                                    <div id="my-id-badge" style="color:#666; font-family:monospace; margin-top:5px;">ID: ???</div>
                                </div>
                            </div>
                            
                            <div class="file-grid">
                                <label class="file-zone" for="avi-in"><i class="fas fa-user"></i><span>Avatar</span></label>
                                <label class="file-zone" for="banner-in"><i class="fas fa-image"></i><span>Banner</span></label>
                            </div>
                            <input type="file" id="avi-in" hidden accept="image/*">
                            <input type="file" id="banner-in" hidden accept="image/*">
                            
                            <input type="text" id="my-nick" placeholder="Codename">
                            <textarea id="my-bio" rows="3" placeholder="Bio..."></textarea>
                            <button class="btn-solid" onclick="Profile.save()">SAVE CHANGES</button>
                        </div>
                    </div>
                </div>

                <div id="tab-admin" class="tab-pane">
                    <div class="top-bar"><div class="top-title text-danger">ROOT</div></div>
                    <div class="admin-scroll-area"> <div id="super-admin-controls" class="hidden mb-20">
                            <button class="btn-danger" onclick="Admin.nuke('news')">WIPE NEWS</button>
                        </div>
                        <div id="admin-list" class="admin-grid"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-user" class="modal-overlay">
        <div class="modal-content profile-card-modal">
            <div id="u-banner" class="p-banner"></div>
            <div class="p-avi-wrapper"><img id="u-avi" class="p-avi"><div id="u-status" class="p-status"></div></div>
            <div class="p-body">
                <div id="u-name" class="p-name"></div>
                <div id="u-id" class="p-id"></div>
                <div id="u-badges" class="p-badges"></div>
                <div id="u-role" class="p-role"></div>
                <div class="p-actions">
                    <button class="btn-solid" onclick="Chat.startDM()">MESSAGE</button>
                    <button class="btn-danger" id="btn-block" onclick="Block.toggle()">BLOCK</button>
                    <button class="btn-text" onclick="document.getElementById('modal-user').classList.remove('open')">CLOSE</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-create" class="modal-overlay">
        <div class="modal-box">
            <h3>NEW CHANNEL</h3>
            <div class="file-grid">
                <label class="file-zone" for="new-ch-avi"><i class="fas fa-icons"></i><span>Icon</span></label>
                <label class="file-zone" for="new-ch-banner"><i class="fas fa-panorama"></i><span>Banner</span></label>
            </div>
            <input type="file" id="new-ch-avi" hidden accept="image/*">
            <input type="file" id="new-ch-banner" hidden accept="image/*">

            <input type="text" id="new-ch-name" placeholder="Name">
            
            <label class="toggle-wrapper">
                <input type="checkbox" id="new-ch-priv" class="toggle-checkbox">
                <div class="toggle-switch"></div>
                <div class="toggle-label">Private Channel</div>
            </label>

            <input type="password" id="new-ch-pass" class="hidden" placeholder="Password">
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="btn-solid" onclick="Channels.create()">CREATE</button>
                <button class="btn-danger" onclick="document.getElementById('modal-create').classList.remove('open')">CANCEL</button>
            </div>
        </div>
    </div>

    <div id="modal-channel-settings" class="modal-overlay">
        <div class="modal-box">
            <h3>CHANNEL SETTINGS</h3>
            <div class="file-grid">
                <label class="file-zone" for="edit-ch-avi"><i class="fas fa-icons"></i><span>Icon</span></label>
                <label class="file-zone" for="edit-ch-banner"><i class="fas fa-panorama"></i><span>Banner</span></label>
            </div>
            <input type="file" id="edit-ch-avi" hidden accept="image/*">
            <input type="file" id="edit-ch-banner" hidden accept="image/*">

            <input type="text" id="edit-ch-name" placeholder="Channel Name">
            <div style="display:flex; flex-direction:column; gap:10px; margin-top:20px;">
                <button class="btn-solid" onclick="Channels.saveSettings()">SAVE</button>
                <button class="btn-danger" onclick="Channels.del()">DELETE CHANNEL</button>
                <button class="btn-text" onclick="document.getElementById('modal-channel-settings').classList.remove('open')">CANCEL</button>
            </div>
        </div>
    </div>

    <div id="modal-pass" class="modal-overlay"><div class="modal-box"><h3>ACCESS</h3><input type="password" id="ch-auth-pass"><div style="display:flex; gap:10px; margin-top:20px;"><button class="btn-solid" onclick="Channels.auth()">ENTER</button><button class="btn-danger" onclick="document.getElementById('modal-pass').classList.remove('open')">X</button></div></div></div>
    <div id="modal-edit" class="modal-overlay"><div class="modal-box"><h3>EDIT</h3><textarea id="edit-text" rows="3"></textarea><div style="display:flex; gap:10px; margin-top:20px;"><button class="btn-solid" onclick="Chat.confirmEdit()">SAVE</button><button class="btn-danger" onclick="document.getElementById('modal-edit').classList.remove('open')">X</button></div></div></div>
    <div id="modal-img" class="modal-overlay" onclick="this.classList.remove('open')"><img id="full-img" style="max-width:95%; max-height:90%; border-radius:12px; border:2px solid #d600ff;"></div>
    <div id="custom-alert" class="modal-overlay"><div class="modal-box"><h3 id="alert-title"></h3><p id="alert-text" style="color:#aaa;"></p><button class="btn-solid" style="margin-top:20px;" onclick="document.getElementById('custom-alert').classList.remove('open')">OK</button></div></div>
    <div id="custom-confirm" class="modal-overlay"><div class="modal-box"><h3 id="confirm-title"></h3><p id="confirm-text" style="color:#aaa;"></p><div style="display:flex; gap:10px; margin-top:20px;"><button id="btn-confirm-yes" class="btn-solid">YES</button><button class="btn-danger" onclick="UI.closeConfirm()">NO</button></div></div></div>

    <script src="functions/config.js"></script>
    <script src="functions/state.js"></script>
    <script src="functions/utils.js"></script>
    <script src="functions/ui.js"></script>
    <script src="functions/profile.js"></script>
    <script src="functions/chat.js"></script>
    <script src="functions/channels.js"></script>
    <script src="functions/search.js"></script>
    <script src="functions/admin.js"></script>
    <script src="functions/auth.js"></script>
    <script src="functions/main.js"></script>
    <script>
        document.getElementById('new-ch-priv').onchange = e => document.getElementById('new-ch-pass').classList.toggle('hidden', !e.target.checked);
    </script>
</body>
</html>